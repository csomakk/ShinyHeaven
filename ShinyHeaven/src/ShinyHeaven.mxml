<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:p="http://www.spicefactory.org/parsley"
               xmlns:uiframe="org.shinyheaven.uiframe.*"
               xmlns:charting="org.shinyheaven.datavisualization.charting.*" xmlns:news="org.shinyheaven.news.*">
    <fx:Declarations>
        <p:ContextBuilder config="{Config}"/>
        <p:Configure/>
    </fx:Declarations>
    <fx:Script>
        <![CDATA[
			import mx.binding.utils.BindingUtils;
			import mx.logging.ILogger;
			import mx.logging.Log;
			import mx.logging.LogEventLevel;
			import mx.logging.targets.TraceTarget;
			
			import org.shinyheaven.news.INewsDataProvider;
			import org.shinyheaven.news.NewsDisplay;
			import org.shinyheaven.service.CommunicationModule;
			import org.shinyheaven.service.dto.IChartDataProvider;
			import org.shinyheaven.service.dto.OHLCUpdate;

			public static var logger:ILogger = Log.getLogger("com.shinyheaven.logger");

            [Inject]
	        public var commModule:CommunicationModule;
	
	        [Inject]
	        [Bindable]
	        public var chartData:IChartDataProvider;
			
			[Inject]
			[Bindable]
			public var newsData:INewsDataProvider;
	
	        [Init]
	        public function onInit():void 
			{
				configureLogger();
				addBindings();
	        }
			
			public function addBindings():void{
				logger.info("ShinyHeaven.onInit: binding {0} suff", dummies.length)
				BindingUtils.bindProperty(lineChart, 'dataProvider', chartData, 'data');
				BindingUtils.bindProperty(flexChart, 'dataProvider', chartData, 'data');
				BindingUtils.bindProperty(newsDisplay, 'dataProvider', newsData, 'data');
			}
			
			public function configureLogger():void{
				var logTarget:TraceTarget = new TraceTarget();
				
				logTarget.filters=["com.shinyheaven.*"];
				
				logTarget.level = LogEventLevel.ERROR;
				
				logTarget.includeDate = true;
				logTarget.includeTime = true;
				logTarget.includeCategory = false;
				logTarget.includeLevel = true;
				
				Log.addTarget(logTarget);
			}
			
	
	        /**
	         * This is for making Flash recognise the [RemoteClass] metadata on these classes.
	         */
	        private var dummies:Array = [OHLCUpdate];
			
        ]]>
    </fx:Script>
    <uiframe:MDI id="mdi" positions="left 20%, bottom 20%, rest: topright">
        <s:Label text="foo"/>
		<news:NewsDisplay id="newsDisplay" />
        <charting:LineChart id="lineChart"
                                     width="100%" height="100%"
                                     skinClass="org.shinyheaven.datavisualization.charting.skins.DefaultLineChartSkin"/>
        <charting:FlexLineChart id="flexChart" width="100%" height="100%" />
    </uiframe:MDI>
</s:Application>
